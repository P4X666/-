<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮播图练习</title>
    <link rel="stylesheet" href="./Carousel.css" />
    <script src="./Carousel.js"></script>
</head>

<body>

    <div id="container">
        <div class="button">
            <div class="pre"></div>
            <div class="next"></div>
        </div>
        <ul class="list" style="height: 400px;">
            <li>0<img src="../img1.image"></li>
            <li>1<img src="../img2.image"></li>
            <li>2<img src="../img3.image"></li>
            <li>3<img src="../img4.image"></li>
        </ul>
        <ul class="dots">
            <li attr="0" class="active"></li>
            <li attr="1"></li>
            <li attr="2"></li>
            <li attr="3"></li>
        </ul>
    </div>
    <script>
        /**
        *   中级版相较于初级版，运行动画更加的流畅
        **/
        const interval = 2000 //时间间隔
        const width = 500// 轮播图的宽度
        let intervalId = null //  定时器
        // 图片集合
        const lists = document.querySelector(".list")
        const listItem = Array.from(lists.children)
        // 圆点集合
        const dots = document.querySelector(".dots")
        const dot = Array.from(dots.children)
        // 前后按钮集合
        const button = document.querySelector(".button")
        let current = 0, max = listItem.length
        // 存储圆点的状态
        const dotSelect = {
            preDot: dot[0],
            currentDot: dot[0]
        }
        let timeOut = null
        const animationInOrder = [max - 1, 0] // 初始化 拥有动画的三个节点
        // li 预处理
        const half = max / 2
        pretreatment()
        /**
        *   轮播图的状态初始化
        **/
        function pretreatment() {

            for (let i = 0; i < max; i++) {
                const item = listItem[i];
                // 以第一个元素为中心对称 右侧为正的，左侧为负的
                let left = i > half ? (i - max) * width : i * width
                if (i == 0) {
                    item.classList.add("is-active")
                    item.classList.add("is-animating")
                }

                if (i == max - 1) {
                    item.classList.add("is-animating")
                }
                item.style.transform = `translateX(${left}px)`
                item.classList.add("el-carousel__item")
            }
            // handleAnimation()
        }
        function handleAnimation() {
            listItem[animationInOrder[0]].classList.add("is-animating")
            listItem[animationInOrder[1]].classList.add("is-active")
            listItem[animationInOrder[1]].classList.add("is-animating")
            listItem[animationInOrder[2]].classList.add("is-animating")
        }
        button.addEventListener("click", function (e) {

            const target = e.target
            if (target.className == "next") {
                // 到下一页
                goNext()
            }
            if (target.className == "pre") {
                // 到上一页
                goPre()
            }
        })

        function goNext(cur) {
            current++
            if (current == max) {
                current = 0
            }
            if (animationInOrder.includes(current)) {
                listItem[current].classList.add("is-active")
                listItem[animationInOrder[0]].classList.remove("is-active")
            } else {
                const pre_preLi = animationInOrder.shift()
                const preLi = animationInOrder[0]
                listItem[current].classList.add("is-active")
                listItem[current].classList.add("is-animating")
                listItem[pre_preLi].classList.remove("is-animating")
                listItem[preLi].classList.remove("is-active")

                animationInOrder.push(current)
            }
            for (let i = 0; i < max; i++) {
                let left = parseInt(listItem[i].style.transform.split("translateX(")[1])

                left = left - width
                if (left < -half * width) {
                    left = -left - half * width
                }

                listItem[i].style.transform = `translateX(${left}px)`
            }
            handleDot(current)

            if (cur && current < cur) {
                goNext(cur)
            }
        }

        function goPre(cur) {
            current--
            if (current < 0) {
                current = max - 1
            }
            if (animationInOrder.includes(current)) {
                listItem[current].classList.add("is-active")
                listItem[animationInOrder[1]].classList.remove("is-active")
            } else {
                const pre_preLi = animationInOrder.pop()
                const preLi = animationInOrder[0]
                listItem[current].classList.add("is-active")
                listItem[current].classList.add("is-animating")
                listItem[pre_preLi].classList.remove("is-animating")
                listItem[preLi].classList.remove("is-active")

                animationInOrder.unshift(current)
            }
            for (let i = 0; i < max; i++) {
                let left = parseInt(listItem[i].style.transform.split("translateX(")[1])

                left = left + width
                if (left > half * width) {
                    left = half * width - left
                }
                listItem[i].style.transform = `translateX(${left}px)`
            }

            handleDot(current)
            if (cur && current > cur) {
                goPre(cur)
            }
        }

        function handleDot(current) {
            current = current % max
            dotSelect.preDot = dotSelect.currentDot
            dotSelect.currentDot = dot[current]
            dotSelect.currentDot.className = "active"
            dotSelect.preDot.className = ""
        }

        // 监听白点的点击事件
        dots.addEventListener("click", function (e) {
            const dot = e.target
            if (dot.tagName === "LI") {
                let value = dot.attributes[0].value
                value = +value

                if (value > current) {
                    goNext(value)
                } else {
                    goPre(value)
                }
            }
        })

        function autoPlay() {
            if (intervalId) {
                removeAnima()
            }
            intervalId = setInterval(() => {
                goNext()
            }, interval);
        }
        // autoPlay() 


        function removeAnima() {
            clearInterval(intervalId)
            intervalId = null
        }
        const container = document.querySelector("#container")
        // 当鼠标悬停在父盒子上时，停止动画
        container.addEventListener("mouseover",function(e){
            removeAnima()
        })
        // 当鼠标悬停在父盒子上时，开始动画
        container.addEventListener("mouseout",function(e){
            autoPlay() 
        })
    </script>
</body>

</html>